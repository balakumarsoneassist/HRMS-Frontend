<div class="card p-3">
  <div class="grid mb-3">
    <!-- Date Picker -->
    <div class="col-3">
      <p-calendar [(ngModel)]="reportDate" dateFormat="yy-mm-dd"></p-calendar>
    </div>

    <!-- Buttons -->
    <div class="col-9 flex gap-2">
      <button pButton label="Live Report" icon="pi pi-refresh"
              (click)="loadLive()" class="p-button-info"></button>

      <button pButton label="Append Report" icon="pi pi-save"
              (click)="appendReport()" class="p-button-success"></button>

      <button pButton label="Monthly Report" icon="pi pi-calendar"
              (click)="loadMonthly()" class="p-button-warning"></button>
    </div>
  </div>

  <!-- Table -->
  <p-table [value]="attendanceList"
           [paginator]="true"
           [rows]="limit"
           [totalRecords]="total"
           [loading]="loading"
           [rowsPerPageOptions]="[5, 10, 20]"
           [responsiveLayout]="'scroll'">
    <ng-template pTemplate="header">
      <tr>
        <th>Emp ID</th>
        <th>User Name</th>
        <th>Type</th>
        <th>Date</th>
        <th>Login</th>
        <th>Logout</th>
        <th>Remarks</th>
        <th>Approved</th>
        <th>Changed By</th>
        <th>changedRemarks</th>
        <th>resonforLOP</th>
        <th>Holiday</th>
        <th>Action</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-att>
      <tr>
        <td>{{ att.userId?.empId }}</td>
        <td>{{ att.userId?.user_name }}</td>
        <td>{{ att.attendanceType }}</td>
        <td>{{ att.date | date:'yyyy-MM-dd' }}</td>
        <td>{{ att.geoTaglogin?.date | date:'shortTime' }}</td>
        <td>{{ att.geoTaglogout?.date | date:'shortTime' }}</td>
        <td>{{ att.remarks || '-' }}</td>
        <td>
          <span [ngClass]="{
            'text-green-500': att.approved === true,
            'text-red-500': att.approved === false
          }">
            {{ att.approved === null ? 'Pending' : (att.approved ? 'Approved' : 'Rejected') }}
          </span>
        </td>
        <td>
          <div *ngIf="att.changedBy; else noChange">
            {{ att.changedBy.user_name }} ({{ att.changedBy.empId }})
          </div>
          <ng-template #noChange>-</ng-template>
        </td>
        <td>{{att.changedRemarks}}</td>

        <td>{{att.resonforLOP}}</td>
       <td>
  <ng-container *ngIf="att.isHoliday === null || att.isHoliday === true; else workingDay">
    <button pButton label="Holiday" class="p-button-sm"
            (click)="openApprovalCompoffDialog(att)"></button>
  </ng-container>
  <ng-template #workingDay>
    Working Day
  </ng-template>
</td>

<td>
  <ng-container *ngIf="att.approved === false || att.approved === null; else approvedText">
    <button pButton label="Review" class="p-button-sm"
            (click)="openApprovalDialog(att)"></button>
  </ng-container>
  <ng-template #approvedText>
    Approved
  </ng-template>
</td>

      </tr>
    </ng-template>
  </p-table>
</div>

<!-- Approval Dialog -->
<p-dialog header="Review Attendance"
          [(visible)]="approvalDialog"
          [modal]="true" [style]="{width: '400px'}">
  <p>Do you want to approve (override to Present) or reject this attendance?</p>
  <div class="flex justify-content-end gap-2 mt-3">
    <button pButton label="Approve" class="p-button-success" (click)="markAsPresent()"></button>
    <button pButton label="Reject" class="p-button-danger" (click)="rejectAttendance()"></button>
  </div>
</p-dialog>

<p-dialog header="Compoff Approval"
          [(visible)]="approvalDialog"
          [modal]="true" [style]="{width: '400px'}">
  <p>Do you want to approve (override to Present) or reject this attendance?</p>
  <div class="flex justify-content-end gap-2 mt-3">
    <button pButton label="Approve" class="p-button-success" (click)="markAsPresent()"></button>
    <button pButton label="Reject" class="p-button-danger" (click)="rejectAttendance()"></button>
  </div>
</p-dialog>
