<form [formGroup]="form" (ngSubmit)="saveDetails(true)" class="p-fluid">
  <div class="card flex justify-content-center">
    <p-accordion value="0">
      <!-- Personal Details -->
      <p-accordion-panel value="0">
        <p-accordion-header>
          <ng-template #toggleicon let-active="active">
            @if (active) {
              <i class="pi pi-minus"></i>
            } @else {
              <i class="pi pi-plus"></i>
            }
          </ng-template>
          <span class="flex items-center gap-2 w-full">
            <i class="pi pi-user"></i>
            <span class="font-bold whitespace-nowrap">Personal Details</span>
          </span>
        </p-accordion-header>
        <p-accordion-content>
          <div [formGroup]="personal" class="grid">
                 <div [formGroup]="personal" class="grid">
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <input
                  pInputText
                  id="FirstName"
                  formControlName="FirstName"
                />
                <label for="FirstName">First Name*</label>
              </p-floatLabel>
              <small
                class="p-error"
                *ngIf="personal.get('FirstName')?.touched && personal.get('FirstName')?.invalid"
                >First name is required</small
              >
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <input
                  pInputText
                  id="LastName"
                  formControlName="LastName"
                />
                <label for="LastName">Last Name*</label>
              </p-floatLabel>
              <small
                class="p-error"
                *ngIf="personal.get('LastName')?.touched && personal.get('LastName')?.invalid"
                >Last name is required</small
              >
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <input
                  pInputText
                  id="MobileNumber"
                  formControlName="MobileNumber"
                />
                <label for="MobileNumber">Mobile Number*</label>
              </p-floatLabel>
              <small
                class="p-error"
                *ngIf="personal.get('MobileNumber')?.touched && personal.get('MobileNumber')?.invalid"
                >Valid 10-digit mobile number required</small
              >
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <input
                  pInputText
                  id="Email"
                  formControlName="Email"
                />
                <label for="Email">Email*</label>
              </p-floatLabel>
              <small
                class="p-error"
                *ngIf="personal.get('Email')?.touched && personal.get('Email')?.invalid"
                >Valid email required</small
              >
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <p-dropdown
                  inputId="LocationId"
                  formControlName="LocationId"
                  [options]="LocationList"
                  optionLabel="Location"
                  optionValue="Id"
                  placeholder="Select Location"
                ></p-dropdown>
                <label for="LocationId">Location*</label>
              </p-floatLabel>
              <small
                class="p-error"
                *ngIf="personal.get('LocationId')?.touched && personal.get('LocationId')?.invalid"
                >Location required</small
              >
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <p-calendar
                  id="DateOfBirth"
                  formControlName="DateOfBirth"
                  dateFormat="dd-mm-yy"
                  showIcon="true"
                  placeholder="Enter DOB"
                ></p-calendar>
                <label for="DateOfBirth">Date of Birth</label>
              </p-floatLabel>
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <input
                  pInputText
                  id="PanNumber"
                  formControlName="PanNumber"
                />
                <label for="PanNumber">PAN Number</label>
              </p-floatLabel>
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <input
                  pInputText
                  id="AadharNumber"
                  formControlName="AadharNumber"
                />
                <label for="AadharNumber">Aadhar Number</label>
              </p-floatLabel>
            </div>
            <div class="col-12">
              <p-floatLabel>
                <input
                  pInputText
                  id="PresentAddress"
                  formControlName="PresentAddress"
                />
                <label for="PresentAddress">Present Address</label>
              </p-floatLabel>
            </div>
            <div class="col-12">
              <p-floatLabel>
                <input
                  pInputText
                  id="PermanentAddress"
                  formControlName="PermanentAddress"
                />
                <label for="PermanentAddress">Permanent Address</label>
              </p-floatLabel>
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <p-dropdown
                  inputId="Gender"
                  formControlName="Gender"
                  [options]="[
                    { label: 'Male', value: 'Male' },
                    { label: 'Female', value: 'Female' }
                  ]"
                  placeholder="Select Gender"
                ></p-dropdown>
                <label for="Gender">Gender</label>
              </p-floatLabel>
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <p-dropdown
                  inputId="MaterialStatus"
                  formControlName="MaterialStatus"
                  [options]="[
                    { label: 'Single', value: 'Single' },
                    { label: 'Married', value: 'Married' }
                  ]"
                  placeholder="Select Status"
                ></p-dropdown>
                <label for="MaterialStatus">Marital Status</label>
              </p-floatLabel>
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <input
                  pInputText
                  id="NoOfDependent"
                  formControlName="NoOfDependent"
                />
                <label for="NoOfDependent">No. of Dependents</label>
              </p-floatLabel>
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <input
                  pInputText
                  id="EducationalQualification"
                  formControlName="EducationalQualification"
                />
                <label for="EducationalQualification">Educational Qualification</label>
              </p-floatLabel>
            </div>
          </div>
          </div>
        </p-accordion-content>
      </p-accordion-panel>

      <!-- Occupation Details -->
      <p-accordion-panel value="1">
        <p-accordion-header>
          <ng-template #toggleicon let-active="active">
            @if (active) {
              <i class="pi pi-minus"></i>
            } @else {
              <i class="pi pi-plus"></i>
            }
          </ng-template>
          <span class="flex items-center gap-2 w-full">
            <i class="pi pi-briefcase"></i>
            <span class="font-bold whitespace-nowrap">Occupation Details</span>
          </span>
        </p-accordion-header>
        <p-accordion-content>
            <ng-container *ngIf="occupation.length > 0">
          <div
            formArrayName="occupation">
            <div

            *ngFor="let occ of occupation.controls; let i = index"
            [formGroupName]="i"
            class="grid border rounded p-3 mb-3"
          >
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <p-dropdown
                  inputId="Occupation{{i}}"
                  formControlName="Occupation"
                  [options]="[
                    { label: 'Salaried', value: 'Salaried' },
                    { label: 'Self Employee', value: 'Self Employee' }
                  ]"
                  placeholder="Select Occupation"
                ></p-dropdown>
                <label for="Occupation{{i}}">Occupation*</label>
              </p-floatLabel>
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <input
                  pInputText
                  id="CompanyName{{i}}"
                  formControlName="CompanyName"
                />
                <label for="CompanyName{{i}}">Company Name</label>
              </p-floatLabel>
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <input
                  pInputText
                  id="CompanyAddress{{i}}"
                  formControlName="CompanyAddress"
                />
                <label for="CompanyAddress{{i}}">Company Address</label>
              </p-floatLabel>
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <input
                  pInputText
                  id="Designation{{i}}"
                  formControlName="Designation"
                />
                <label for="Designation{{i}}">Designation</label>
              </p-floatLabel>
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <p-calendar
                  id="JoiningDate{{i}}"
                  formControlName="JoiningDate"
                  dateFormat="dd-mm-yy"
                  showIcon="true"
                ></p-calendar>
                <label for="JoiningDate{{i}}">Joining Date</label>
              </p-floatLabel>
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <input
                  pInputText
                  id="OfficeTelephoneNumber{{i}}"
                  formControlName="OfficeTelephoneNumber"
                />
                <label for="OfficeTelephoneNumber{{i}}">Office Tel No.</label>
              </p-floatLabel>
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <input
                  pInputText
                  id="CompanyGSTINNumber{{i}}"
                  formControlName="CompanyGSTINNumber"
                />
                <label for="CompanyGSTINNumber{{i}}">Company GSTIN</label>
              </p-floatLabel>
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <input
                  pInputText
                  id="IncomeAmount{{i}}"
                  formControlName="IncomeAmount"
                />
                <label for="IncomeAmount{{i}}">Income</label>
              </p-floatLabel>
            </div>
            <div class="col-12 md:col-6">
              <p-floatLabel>
                <input
                  pInputText
                  id="OtherIncomeAmount{{i}}"
                  formControlName="OtherIncomeAmount"
                />
                <label for="OtherIncomeAmount{{i}}">Other Income</label>
              </p-floatLabel>
            </div>
            <div class="col-12 flex gap-2 mt-2">
              <button
                pButton
                type="button"
                icon="pi pi-plus"
                label="Add"
                class="p-button-success"
                (click)="addOccupation()"
              ></button>
              <button
                pButton
                type="button"
                icon="pi pi-trash"
                label="Remove"
                class="p-button-danger"
                *ngIf="occupation.length > 1"
                (click)="deleteOccupation(i)"
              ></button>
            </div>
          </div>
          </div>
          </ng-container>
        </p-accordion-content>
      </p-accordion-panel>

      <!-- Bank Details -->
      <p-accordion-panel value="2">
        <p-accordion-header>
          <ng-template #toggleicon let-active="active">
            @if (active) {
              <i class="pi pi-minus"></i>
            } @else {
              <i class="pi pi-plus"></i>
            }
          </ng-template>
          <span class="flex items-center gap-2 p-2 w-full">
            <i class="pi pi-credit-card"></i>
            <span class="font-bold whitespace-nowrap">Bank Details</span>
          </span>
        </p-accordion-header>
       <p-accordion-content>
          <ng-container *ngIf="bankDetails.length > 0">
  <div
    formArrayName="bankDetails"><div
    *ngFor="let bank of bankDetails.controls; let i = index"
    [formGroupName]="i"
    class="grid border rounded p-3 mb-3"
  >
    <div class="col-12 md:col-6">
      <p-floatLabel>
        <p-dropdown
          inputId="BankName{{i}}"
          formControlName="BankName"
          [options]="BankList"
          optionLabel="BankName"
          placeholder="Select Bank"
        ></p-dropdown>
        <label for="BankName{{i}}">Bank Name</label>
      </p-floatLabel>
    </div>

    <div class="col-12 md:col-6">
      <p-floatLabel>
        <input
          pInputText
          id="Branch{{i}}"
          formControlName="Branch"
        />
        <label for="Branch{{i}}">Branch</label>
      </p-floatLabel>
    </div>

    <div class="col-12 md:col-6">
      <p-floatLabel>
        <input
          pInputText
          id="IfscCode{{i}}"
          formControlName="IfscCode"
        />
        <label for="IfscCode{{i}}">IFSC Code</label>
      </p-floatLabel>
    </div>

    <div class="col-12 md:col-6">
      <p-floatLabel>
        <input
          pInputText
          id="AccountNumber{{i}}"
          formControlName="AccountNumber"
        />
        <label for="AccountNumber{{i}}">Account Number</label>
      </p-floatLabel>
    </div>

    <div class="col-12 flex gap-2 mt-2">
      <button
        pButton
        type="button"
        icon="pi pi-plus"
        label="Add"
        class="p-button-success"
        (click)="addBank()"
      ></button>
      <button
        pButton
        type="button"
        icon="pi pi-trash"
        label="Remove"
        class="p-button-danger"
        *ngIf="bankDetails.length > 1"
        (click)="deleteBank(i)"
      ></button>
    </div>
  </div>
  </div>
  </ng-container>
</p-accordion-content>

      </p-accordion-panel>

      <!-- Loan Details -->
      <p-accordion-panel value="3">
        <p-accordion-header>
          <ng-template #toggleicon let-active="active">
            @if (active) {
              <i class="pi pi-minus"></i>
            } @else {
              <i class="pi pi-plus"></i>
            }
          </ng-template>
          <span class="flex items-center gap-2 w-full">
            <i class="pi pi-dollar"></i>
            <span class="font-bold whitespace-nowrap">Loan Details</span>
          </span>
        </p-accordion-header>
       <p-accordion-content>
          <ng-container *ngIf="loanHistory.length > 0">
  <div
    formArrayName="loanHistory"><div
    *ngFor="let loan of loanHistory.controls; let i = index"
    [formGroupName]="i"
    class="grid border rounded p-3 mb-3"
  >
    <div class="col-12 md:col-6">
      <p-floatLabel>
        <p-dropdown
          inputId="LoanType{{i}}"
          formControlName="LoanType"
          [options]="[
            { label: 'Personal Loan', value: 'Personal Loan' },
            { label: 'Business Loan', value: 'Business Loan' },
            { label: 'Auto Loan - New', value: 'Auto Loan - New' },
            { label: 'Auto Loan - Used', value: 'Auto Loan - Used' },
            { label: 'Home Loan', value: 'Home Loan' },
            { label: 'Jewel Loan', value: 'Jewel Loan' }
          ]"
          placeholder="Select Loan Type"
        ></p-dropdown>
        <label for="LoanType{{i}}">Loan Type</label>
      </p-floatLabel>
    </div>

    <div class="col-12 md:col-6">
      <p-floatLabel>
        <input
          pInputText
          id="LoanAmount{{i}}"
          formControlName="LoanAmount"
        />
        <label for="LoanAmount{{i}}">Loan Amount</label>
      </p-floatLabel>
    </div>

    <div class="col-12 md:col-6">
      <p-floatLabel>
        <input
          pInputText
          id="ROI{{i}}"
          formControlName="ROI"
        />
        <label for="ROI{{i}}">Rate of Interest</label>
      </p-floatLabel>
    </div>

    <div class="col-12 md:col-6">
      <p-floatLabel>
        <input
          pInputText
          id="Tenure{{i}}"
          formControlName="Tenure"
        />
        <label for="Tenure{{i}}">Tenure (Years)</label>
      </p-floatLabel>
    </div>

    <div class="col-12 md:col-6">
      <p-floatLabel>
        <p-calendar
          id="SanctionDate{{i}}"
          formControlName="SanctionDate"
          dateFormat="dd-mm-yy"
          showIcon="true"
        ></p-calendar>
        <label for="SanctionDate{{i}}">Sanction Date</label>
      </p-floatLabel>
    </div>

    <div class="col-12 flex gap-2 mt-2">
      <button
        pButton
        type="button"
        icon="pi pi-plus"
        label="Add"
        class="p-button-success"
        (click)="addLoan()"
      ></button>
      <button
        pButton
        type="button"
        icon="pi pi-trash"
        label="Remove"
        class="p-button-danger"
        *ngIf="loanHistory.length > 1"
        (click)="deleteLoan(i)"
      ></button>
    </div>
  </div>
  </div>
  </ng-container>
</p-accordion-content>

      </p-accordion-panel>
    </p-accordion>
  </div>

  <div class="flex justify-end gap-2 mt-4">
    <button
      pButton
      type="submit"
      label="Save"
      icon="pi pi-save"
      class="p-button-success"
    ></button>
    <button
      pButton
      type="button"
      label="Save & Close"
      icon="pi pi-check"
      class="p-button-secondary"
      (click)="saveDetails(false)"
      [hidden]="isSaveAndClose"
    ></button>
  </div>
</form>
