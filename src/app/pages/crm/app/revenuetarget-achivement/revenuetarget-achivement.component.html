<p-toast></p-toast>

<div class="card p-4 shadow-3 border-round-xl">
  <h4 class="mb-4 text-green-600 font-bold">Revenue Achievement</h4>

  <form [formGroup]="form" class="formgrid grid gap-4 mb-4">
    <!-- Month Dropdown -->
    <div class="field col-12 md:col-3">
      <label class="font-medium text-sm mb-2 block">Month</label>
      <p-dropdown
        [options]="monthOptions"
        optionLabel="label"
        formControlName="month"
        (onChange)="changeMonth($event)"
        placeholder="Select Month"
        class="w-full">
      </p-dropdown>
    </div>

    <!-- Year Dropdown -->
    <div class="field col-12 md:col-3">
      <label class="font-medium text-sm mb-2 block">Year</label>
      <p-dropdown
        [options]="yearOptions"
        optionLabel="label"
        formControlName="year"
        (onChange)="changeYear($event)"
        placeholder="Select Year"
        class="w-full">
      </p-dropdown>
    </div>

    <!-- Financial Year -->
    <div class="field col-12 md:col-3">
      <label class="font-medium text-sm mb-2 block">Financial Year</label>
      <input pInput [disabled]="true" formControlName="fyear" class="w-full"/>
    </div>

    <!-- Get Data Button -->
    <div class="field col-12 md:col-3 flex align-items-end">
      <button
        pButton
        type="button"
        label="Get Data"
        class="p-button-success w-full"
        (click)="Getdata()"
        [disabled]="loaderService.showLoader">
      </button>
    </div>
  </form>

  <!-- Loader -->
  <div class="flex justify-content-center mb-3" *ngIf="loaderService.showLoader && loadSpin > 0">
    <p-progressSpinner strokeWidth="4"></p-progressSpinner>
  </div>

  <!-- Revenue Table Section -->
  <div *ngFor="let TList of AchieveList; let i = index" class="mb-5 border-round surface-section p-3 shadow-1">
    <div class="font-bold mb-3 text-lg text-primary">#{{ i + 1 }} - {{ TList.Name }}</div>

    <p-table [value]="[TList]" class="p-datatable-sm" >
      <ng-template pTemplate="body" let-row>
        <tr class="bg-color-ContHead text-white">
          <td colspan="10">
            <div class="flex justify-content-between align-items-center">
              <span><strong>Employee Name:</strong> {{ row.Name }}</span>
              <button
                pButton
                icon="pi pi-search"
                label="Get Details"
                class="p-button-rounded p-button-info p-button-sm"
                (click)="Getdetails(row.LeadFollowedBy, row.Name)">
              </button>
            </div>
          </td>
        </tr>

        <!-- Header Row -->
        <tr class="bg-primary text-white text-center">
          <td colspan="6">Revenue</td>
          <td colspan="1"></td>
          <td colspan="3">File Login</td>
        </tr>

        <!-- Revenue & FileLogin Metrics -->
        <tr class="text-center">
          <td class="font-bold">#</td>
          <td>Total Nos</td>
          <td>Target</td>
          <td>Achievement</td>
          <td>%</td>
          <td>Shortfall</td>
          <td></td>
          <td>Target Count</td>
          <td>Achievement</td>
        </tr>

        <!-- Yearly -->
        <tr class="text-center">
          <td>{{ rfyr }}</td>
          <td>{{ row.RNOS }}</td>
          <td>{{ row.REVTARGET }}</td>
          <td>{{ row.REVAMT }}</td>
          <td>{{ (row.REVAMT / row.REVTARGET) * 100 | number : '1.0-2' }}</td>
          <td>{{ (row.REVTARGET - row.REVAMT) < 0 ? 0 : (row.REVTARGET - row.REVAMT) }}</td>
          <td></td>
          <td>{{ row.FLTARGET }}</td>
          <td>{{ row.FNOS }}</td>
        </tr>

        <!-- Monthly -->
        <tr class="text-center">
          <td>{{ rmon }}</td>
          <td>{{ row.mRNOS }}</td>
          <td>{{ row.mREVTARGET }}</td>
          <td>{{ row.mREVAMT }}</td>
          <td>{{ row.fltarget }}</td>
          <td>{{ row.mREVTARGET - row.mREVAMT }}</td>
          <td></td>
          <td>{{ row.mFLTARGET }}</td>
          <td>{{ row.mRNOS }}</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<app-revenuetarget-details></app-revenuetarget-details>
